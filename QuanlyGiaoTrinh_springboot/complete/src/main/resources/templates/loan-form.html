<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Form Phiếu Mượn</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center text-primary">
            <i class="bi bi-file-earmark-plus"></i>
            <span th:text="${loan.loanID == null || loan.loanID == ''} ? 'Thêm Phiếu Mượn' : 'Sửa Phiếu Mượn'"></span>
        </h2>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-body">
                        <form th:action="@{${loan.loanID == null || loan.loanID == ''} ? '/loans/save' : '/loans/update'}" method="post">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-hash"></i> Mã Phiếu Mượn</label>
                                        <input type="text" name="loanID" class="form-control" 
                                               th:value="${loan != null ? loan.loanID : ''}" 
                                               th:readonly="${loan != null && loan.loanID != null && loan.loanID != ''}"
                                               required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-person-vcard"></i> Mã Độc Giả</label>
                                        <input type="text" name="readerID" class="form-control" 
                                               th:value="${loan != null && loan.reader != null ? loan.reader.readerID : ''}" 
                                               required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-person"></i> Tên Độc Giả</label>
                                        <input type="text" name="readerName" class="form-control" 
                                               th:value="${loan != null && loan.reader != null ? loan.reader.name : ''}" 
                                               required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-book"></i> Mã Sách</label>
                                        <input type="text" name="bookID" class="form-control" 
                                               th:value="${loan != null && loan.book != null ? loan.book.bookID : ''}" 
                                               required>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label"><i class="bi bi-journal"></i> Tên Sách</label>
                                <input type="text" name="bookTitle" class="form-control" 
                                       th:value="${loan != null && loan.book != null ? loan.book.title : ''}" 
                                       required>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-calendar-check"></i> Ngày Mượn</label>
                                        <input type="date" name="borrowDate" class="form-control" 
                                               th:value="${loan != null ? loan.borrowDate : ''}" 
                                               required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-calendar-event"></i> Ngày Hẹn Trả</label>
                                        <input type="date" name="dueDate" class="form-control" 
                                               th:value="${loan != null ? loan.dueDate : ''}" 
                                               required>
                                    </div>
                                </div>
                            </div>

                            <div th:if="${loan != null && loan.loanID != null && loan.loanID != ''}" class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-calendar-x"></i> Ngày Trả (Thực tế)</label>
                                        <input type="date" name="returnDate" class="form-control" 
                                               th:value="${loan.returnDate}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label"><i class="bi bi-check-circle"></i> Trạng Thái</label>
                                        <select name="status" class="form-select">
                                            <option value="Borrowed" th:selected="${loan.status == 'Borrowed'}">Đang mượn</option>
                                            <option value="Returned" th:selected="${loan.status == 'Returned'}">Đã trả</option>
                                            <option value="Overdue" th:selected="${loan.status == 'Overdue'}">Quá hạn</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-center gap-3 mt-4">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-lg"></i> Lưu
                                </button>
                                <a href="/loans" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left"></i> Quay lại
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>